{% extends "page_base.html" %}

{% block head-style %}
  {{ block.super }}
  <link rel="stylesheet" href="{{ STATIC_URL }}css/graph.css">
{% endblock %}

{% block head-scripts %}
  {{ block.super }}
  <script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js?2.9.2"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/graph.js"></script>

  <script type="text/javascript">
    var DATA_URL = "{{ data_url }}";

    $(document).ready(function(){
      force = d3.layout.force()
          .charge(-2000)
          .gravity(1)
          .size([$("#graph").attr("width"),
                 $("#graph").attr("height")])
          .on("tick", function() { update_dom_on_tick(); });

      get_filtered_graph_data(DATA_URL, force);
      $("select.filter").change(function() {
        get_filtered_graph_data(DATA_URL, force);
      });
    });
  </script>
{% endblock %}

{% block content-body %}
  {% for field_name, field, values in filters %}
    <label>{{ field_name }}
      <select name="{{ field }}" class="filter">
        {% for value in values %}
          <option>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
  {% endfor %}
  <svg id=graph width=960 height=800>
    <!-- links before nodes so that nodes are always painted on top -->
    <g id=links></g>
    <g id=nodes></g>
  </svg>
{% endblock %}
