{% extends "page_base.html" %}


{% block head-title %}Georgia Lynchings Timeline{% endblock %}

{% block head-scripts %}
    {{ block.super }}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap/lib/mxn/mxn.js?(googlev3)"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap/lib/timeline-1.2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap/src/timemap.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap/src/loaders/json.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap/src/loaders/progressive.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/timemap_config.js"></script>
{% endblock %}

{% block endscript %}
  {{ block.super }}
  <script type="text/javascript">

    $(document).ready(function() {
      var START_LOCATION = "1899-04-23"; {# date of Sam Hose lynching #}
      var timemap = TimeMap.init({
        mapId: "map",
        timelineId: "timeline",
        options: {
          eventIconPath: "{{ STATIC_URL }}js/timemap/images/",
        },
        datasets: [
          {
            type: "json",
            options: {
              url: "{% url events:map-victim-data %}",
              {# TimeMap infoTemplate language uses literal {{}}, so make them with templatetag #}
              infoTemplate:
                "<div><b>{% templatetag openvariable %}title{% templatetag closevariable %}</b></div> \
                 <div>Date: {% templatetag openvariable %}date{% templatetag closevariable %}</div> \
                 <div>Location: {% templatetag openvariable %}county{% templatetag closevariable %} County</div> \
                 <div>Alleged Crime: {% templatetag openvariable %}alleged_crime{% templatetag closevariable %}</div> \
                 <div><a target='_blank' href='{% templatetag openvariable %}detail_link{% templatetag closevariable %}'>more info</a></div>"
            }
          }
        ],
        bandIntervals: [
          Timeline.DateTime.MONTH,
          Timeline.DateTime.DECADE
        ],
        scrollTo: START_LOCATION
      });

      /* configure the filter dropdowns: */
      $('.filter').each(function() {
        /* find the filter's select elem, and infer the item attribute name
           that we're filtering based on the filter id */
        var select = $(this).find('select');
        var filter_id = $(this).attr('id');
        if (filter_id.substring(0, 7) != 'filter_') {
          /* this filter doesn't have an appropriate id, so bail. */
          return;
        }
        var filter_attribute = filter_id.substring(7);

        /* define the filter function, and apply it to the timeline and map */
        var filter_function = function(item) {
          return filter_timemap_item(item, filter_attribute, select);
        };
        timemap.addFilter("timeline", filter_function);
        timemap.addFilter("map", filter_function);
        /* and configure our select elem to update the timemap on change */
        select.change(update_filtered_items);
      });

      /* Determine if a timemap item matches a defined dropdown filter.
       *  item: a TimeMapItem
       *  filter_option: the name of the item option field to examine
       *  select: the select box controlling the filter
       */
      function filter_timemap_item(item, filter_option, select) {
        var filter_value = select.val();
        if (filter_value && item.opts[filter_option] != filter_value) {
          return false;
        }
        return true;
      }

      /* Update items in a TimeMap, e.g., when a filter changes */
      function update_filtered_items() {
        timemap.filter("timeline");
        timemap.filter("map");
      }

    });
  </script>
{% endblock %}{# endscript #}

{% block head-style %}
   {{ block.super }}
    <link href="{{ STATIC_URL }}style/timemap.css" type="text/css" rel="stylesheet"/>
{% endblock %}

{% block content-title %}Lynchings in Georgia (1875-1930) Timeline Map{% endblock %}

{% block content-body %}
        {# divs for timemap display #}
        <div class="filters">
          <div class="filter" id="filter_alleged_crime">
            <label>Filter alleged crime
              <select>
                <option value="">All alleged crimes</option>
                <option value="Murder">Murder</option>
              </select>
            </label>
          </div>
        </div>

        <div class="mapdisplay">
        <div id="timemap" />
            <div id="timelinecontainer" />
            <div id="timeline">Loading Timeline</div>
            <div id="mapcontainer" class="clearfix">
            <div id="map">Loading Map</div>
        </div>
        </div>
{% endblock %}
